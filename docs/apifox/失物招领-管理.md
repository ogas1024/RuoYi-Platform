# Apifox 指南 —— 失物招领（管理）

- baseURL: `http://localhost:8080`
- 环境变量建议：`base`、`token_admin`
- 通用请求头：`Authorization: Bearer {{token_admin}}`

## 目录结构建议（Apifox 集合）
- 管理端 / 失物招领
  - 列表
    - 已发布列表 GET /manage/lostfound/list
    - 待审列表 GET /manage/lostfound/audit/list
    - 回收列表 GET /manage/lostfound/recycle/list
  - 详情 GET /manage/lostfound/{id}
  - 新增/编辑/删除 POST|PUT|DELETE
  - 审核通过 PUT /{id}/approve
  - 审核驳回 PUT /{id}/reject
  - 下架/恢复 PUT /{id}/offline | /{id}/restore
  - 设置解决状态 PUT /{id}/solve

## 前置步骤
1) 登录管理员
   - POST /login
   - Body: `{ "username":"admin", "password":"123456" }`
   - 断言：`code == 200`
   - 提取：`data.token` → 变量 `token_admin`

## 用例与断言

### 用例 1：审核通过成功
1) 查询待审
   - GET /manage/lostfound/audit/list?pageNum=1&pageSize=10
   - 断言：`code == 200`
   - 提取：`rows[0].id` → `rid`
2) 审核通过
   - PUT /manage/lostfound/{{rid}}/approve
   - 断言：`code == 200`

### 用例 2：审核驳回（原因必填）
- PUT /manage/lostfound/{{rid}}/reject
- Body：`{ "reason":"图片不清晰" }`
- 断言：`code == 200`

### 用例 3：下架与恢复
- 下架：PUT /manage/lostfound/{{rid}}/offline（Body：`{ "reason":"违规信息" }`）→ `code == 200`
- 恢复：PUT /manage/lostfound/{{rid}}/restore → `code == 200`

### 用例 4：设置解决状态
- PUT /manage/lostfound/{{rid}}/solve
- Body：`{ "solved": true }`
- 断言：`code == 200`

### 用例 5：删除
- DELETE /manage/lostfound/{{rid}}
- 断言：`code == 200`

## 断言脚本（示例）
- 统一断言：`status == 200 && body.code == 200`
- 列表：`Array.isArray(body.rows)`，`typeof body.total === 'number'`
- 详情：`body.data && body.data.item && body.data.images`

## 常见失败与定位
- 403 权限不足：未给角色分配 `manage:lostfound:*`
- 409 状态冲突：违反流转（如非待审时调用通过/驳回）
- 404 不存在：ID 无效或已删除
- 500 业务失败：查看 `msg` 并根据后端日志定位

## 提示与最佳实践
- 审核动作需记录原因（驳回/下架必须附 `reason`），便于追溯。
- 建议在 Apifox 用“提取”将 `id` 串联到后续用例，形成端到端流水线。
