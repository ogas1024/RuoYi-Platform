# 数字图书馆-菜单与权限（下载按钮）

目的：让“图书管理员”在“管理端 → 数字图书馆 → 待审核”中，点击“查看”后能看到并使用“下载”按钮。

## 背景说明
- 前端按钮权限：`v-hasPermi=['manage:library:download']`（按钮无该权限将隐藏）。参考：
  - frontend/src/views/manage/library/Audit.vue:26
  - frontend/src/views/manage/library/ApprovedList.vue:34
- 后端接口权限：`GET /manage/library/{id}/download` 受 `@PreAuthorize("@ss.hasPermi('manage:library:download')")` 保护。参考：
  - backend/ruoyi-manage/src/main/java/com/ruoyi/manage/controller/LibraryController.java:109
- 资产类型说明：仅当资产为“文件”(assetType = '0') 显示“下载”；外链(assetType = '1') 显示“打开外链”。

## 操作步骤（RuoYi 后台）
1. 登录后台（管理员）。
2. 系统管理 → 菜单管理 → 搜索“数字图书馆”。
3. 找到“数字图书馆-待审核”（或所属父级菜单），点击“新增”。
   - 菜单类型：按钮
   - 上级菜单：数字图书馆-待审核（或对应父级）
   - 菜单名称：下载图书
   - 权限标识：`manage:library:download`
   - 其余保持默认（是否可见不影响按钮权限）
4. 保存后，进入 系统管理 → 角色管理 → 选择“图书管理员”角色 → 分配菜单，勾选“下载图书”按钮权限。
5. 让该角色用户退出并重新登录（或清空本地缓存后刷新）。

## 验证
1. 管理端 → 数字图书馆 → 待审核。
2. 点击任一记录“查看”。
3. 在“资产”表格中：
   - 若资产类型为“文件”，应出现“下载”按钮；
   - 若为“外链”，显示“打开外链”。
4. 点击“下载”后会跳转到文件地址（后端已记录下载次数）。

## 常见问题排查
- 仍无下载按钮：
  - 确认当前用户是否被授予 `manage:library:download`；
  - 确认资产是否为文件型（`assetType = '0'`）；
  - 重新登录以刷新权限；
  - 浏览器控制台检查 `user.permissions` 是否包含该标识。

## 参考代码
- 按钮权限：frontend/src/views/manage/library/Audit.vue:26
- 后端下载接口：backend/ruoyi-manage/src/main/java/com/ruoyi/manage/controller/LibraryController.java:109

