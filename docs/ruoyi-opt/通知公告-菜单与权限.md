# RuoYi 后台操作指南｜通知公告菜单与权限（含SQL模板）

更新时间：2025-10-19

## 一、目标
- 新增后台“通知公告”目录与菜单；绑定权限：`manage:notice:*`
- 读权限分配给：user/librarian/major_lead/staff/admin/super_admin（至少 list/get）
- 写权限（新增/编辑/删除/发布/置顶）只分配给：staff、admin、super_admin

## 二、后台可视化操作（小白友好）
1) 登录 RuoYi 后台 → 系统管理 → 菜单管理 → 新增（目录）
- 菜单类型：目录
- 菜单名称：通知公告
- 显示排序：1（可按需调整）
- 路由地址：/manage/notice
- 菜单图标：bell（或自选）
- 其他保持默认 → 保存

2) 在“通知公告”目录下 → 新增（菜单）
- 菜单类型：菜单
- 菜单名称：公告管理
- 路由地址：/manage/notice
- 组件路径：manage/notice/index
- 权限标识：manage:notice:list
- 其他保持默认 → 保存

3) 在“公告管理”菜单下 → 新增（按钮，重复以下5次）
- 新增：按钮名称“新增”，权限标识 `manage:notice:add`
- 修改：按钮名称“修改”，权限标识 `manage:notice:edit`
- 删除：按钮名称“删除”，权限标识 `manage:notice:remove`
- 发布/撤回：按钮名称“发布/撤回”，权限标识 `manage:notice:publish`
- 置顶：按钮名称“置顶”，权限标识 `manage:notice:pin`

4) 角色授权（系统管理 → 角色管理）
- user/librarian/major_lead：勾选目录与“公告管理”菜单（至少有 list/get），保留只读
- staff：在只读基础上勾选 add/edit/remove/publish/pin
- admin/super_admin：全选（或通过角色继承已具备）
- 注：变更菜单需重新登录生效；前端按钮需使用 v-hasPermi 对齐

校验要点
- 列表页按钮指令：
  - v-hasPermi=['manage:notice:list']
  - v-hasPermi=['manage:notice:add'] 等
- 后端注解需一致：`@PreAuthorize("@ss.hasPermi('manage:notice:xxx')")`

## 三、SQL 批量插入模板（可选，建议先备份）
说明：以下 SQL 在 MySQL 上执行；会自动创建目录、菜单与按钮。字段对齐 `sys_menu` 模式（无外键），使用 LAST_INSERT_ID() 获取父子关系。

```sql
-- 目录：通知公告
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, remark)
VALUES ('通知公告', 0, 1, 'manage', 'Layout', 1, 0, 'M', '0', '0', NULL, 'bell', 'admin', NOW(), '通知公告目录');
SELECT @dirId := LAST_INSERT_ID();

-- 菜单：公告管理
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, remark)
VALUES ('公告管理', @dirId, 1, 'notice', 'manage/notice/index', 1, 0, 'C', '0', '0', 'manage:notice:list', '#', 'admin', NOW(), '公告管理菜单');
SELECT @menuId := LAST_INSERT_ID();

-- 按钮：查询（详情用）
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告查询', @menuId, 1,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:get', '#', 'admin', NOW());

-- 按钮：新增
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告新增', @menuId, 2,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:add', '#', 'admin', NOW());

-- 按钮：修改
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告修改', @menuId, 3,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:edit', '#', 'admin', NOW());

-- 按钮：删除
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告删除', @menuId, 4,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:remove', '#', 'admin', NOW());

-- 按钮：发布/撤回
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告发布', @menuId, 5,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:publish', '#', 'admin', NOW());
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告撤回', @menuId, 6,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:publish', '#', 'admin', NOW());

-- 按钮：置顶
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time)
VALUES ('公告置顶', @menuId, 7,  '#', '', 1, 0, 'F', '0', '0', 'manage:notice:pin', '#', 'admin', NOW());

-- 可选：隐藏“公告编辑”路由（用于从列表跳转到编辑页）
INSERT INTO sys_menu (menu_name, parent_id, order_num, path, component, is_frame, is_cache, menu_type, visible, status, perms, icon, create_by, create_time, remark)
VALUES ('公告编辑(隐藏)', @dirId, 2, 'notice/edit', 'manage/notice/edit', 1, 0, 'C', '1', '0', NULL, '#', 'admin', NOW(), '隐藏编辑页，仅路由占位');
```

执行后：去“角色管理”为 user/librarian/major_lead 勾选“目录+公告管理菜单+查询按钮”；为 staff 勾选全套按钮；admin/super_admin 通常已有全部权限。

注意
- 如果你已有“业务目录”，可以将目录“通知公告”的 parent_id 设置为该目录的 menu_id
- 如需撤销，可删除对应 sys_menu 记录（谨慎操作）

---

## 四、前端路由与页面映射
- 菜单“公告管理”的组件路径：`manage/notice/index` 已存在页面
- 门户只读页（需自行在前端路由里添加一个公开菜单或在门户区域添加入口）：`portal/notice/index`
